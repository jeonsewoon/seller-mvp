<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>뜻밖의시장 관리자</title>
<meta name="theme-color" content="#0b0b0c">

<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Apple SD Gothic Neo",sans-serif;background:#0b0b0c;color:#fff}
.wrap{max-width:1100px;margin:0 auto;padding:20px}
h1{font-size:26px;margin-bottom:6px}
.muted{color:#aaa;font-size:13px}
.card{background:#16161a;border:1px solid #2a2a2e;border-radius:14px;padding:16px;margin-top:14px}
input,select,button{width:100%;padding:10px;border-radius:10px;border:1px solid #333;background:#000;color:#fff}
button{background:#fff;color:#000;font-weight:800;cursor:pointer}
button.sub{background:#222;color:#fff}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.listItem{padding:10px;border-bottom:1px solid #333;cursor:pointer}
.listItem:hover{background:#222}
.badge{display:inline-block;font-size:11px;padding:3px 8px;border-radius:999px;border:1px solid #555;margin-left:6px}
.ok{color:#7dffb3;border-color:#7dffb3}
.danger{color:#ff8a8a;border-color:#ff8a8a}
.hidden{display:none}
</style>
</head>

<body>
<div class="wrap">

<!-- 로그인 -->
<div id="loginBox" class="card">
  <h1>관리자 로그인</h1>
  <input id="loginId" placeholder="ID">
  <input id="loginPw" type="password" placeholder="Password">
  <button onclick="login()">로그인</button>
</div>

<!-- 관리자 -->
<div id="adminBox" class="hidden">

<h1>행사 관리</h1>
<div class="muted">events.json을 안전한 포맷으로만 저장합니다</div>

<div class="card grid">
  <input id="name" placeholder="행사명">
  <input id="area" placeholder="지역 (예: 동탄)">
  <input id="address" placeholder="주소 입력 후 엔터">
  <input id="start" type="date">
  <input id="end" type="date">
  <input id="capacity" type="number" placeholder="정원">
  <input id="lat" placeholder="위도" readonly>
  <input id="lng" placeholder="경도" readonly>
  <input id="note" placeholder="메모">
</div>

<button onclick="addEvent()">행사 추가 / 수정</button>

<div class="card">
  <h2>행사 목록</h2>
  <div id="list"></div>
</div>

<button class="sub" onclick="saveGitHub()">GitHub에 저장 (events.json)</button>

</div>
</div>

<script>
/* 관리자 계정 */
const ADMINS=["staff1","staff2","staff3"];
const PASSWORD="market2026!";
let EVENTS=[];

/* 로그인 */
function login(){
  const id=document.getElementById("loginId").value;
  const pw=document.getElementById("loginPw").value;
  if(ADMINS.includes(id)&&pw===PASSWORD){
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("adminBox").classList.remove("hidden");
    loadEvents();
  }else alert("로그인 실패");
}

/* 이벤트 로드 */
async function loadEvents(){
  const res=await fetch("./events.json?ts="+Date.now());
  EVENTS=await res.json();
  render();
}

/* 주소 → 위경도 */
async function geocode(addr){
  const r=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(addr)}`);
  const d=await r.json();
  if(!d[0]) return null;
  return {lat:Number(d[0].lat),lng:Number(d[0].lon)};
}

document.getElementById("address").addEventListener("change",async e=>{
  const g=await geocode(e.target.value);
  if(g){lat.value=g.lat;lng.value=g.lng;}
});

/* 추가/수정 */
function addEvent(){
  const ev={
    id:"ev_"+Date.now(),
    name:name.value,
    area:area.value,
    start:start.value,
    end:end.value,
    address:address.value,
    lat:Number(lat.value)||null,
    lng:Number(lng.value)||null,
    capacity:Number(capacity.value)||0,
    current:0,
    note:note.value
  };
  EVENTS.push(ev);
  render();
}

/* 렌더 */
function render(){
  list.innerHTML="";
  EVENTS.forEach(e=>{
    const d=document.createElement("div");
    d.className="listItem";
    d.innerHTML=`<b>${e.name}</b><span class="badge ok">${e.area}</span>`;
    list.appendChild(d);
  });
}

/* GitHub 저장 */
async function saveGitHub(){
  alert("※ GitHub API 연동은 다음 단계에서 연결됩니다.\n지금은 events.json을 직접 수정해 주세요.");
}
</script>

</body>
</html>
